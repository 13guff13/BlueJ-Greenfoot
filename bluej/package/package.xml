<project name="bluej-package" default="dist" basedir=".">

    <patternset id="bluej.libfiles">
        <exclude name="**/.#*" />
        <include name="lib/antlr.jar" />
        <include name="lib/MRJToolkitStubs.zip" />
        <include name="lib/bluej.defs" />
        <include name="lib/bluej.ico" />
        <include name="lib/moe.defs" />
    </patternset>

    <patternset id="bluej.libdirs">
        <exclude name="**/.#*" />
        <include name="lib/inspector/ListInspector*.class" />
        <include name="lib/images/*.gif" />
        <include name="lib/images/*.jpg" />
        <include name="lib/english/" />
        <include name="lib/german/" />
        <include name="lib/swedish/" />
        <include name="lib/spanish/" />
        <include name="lib/japanese/" />
    </patternset>

    <patternset id="bluej.examples">
        <exclude name="**/*.pkh" />
        <exclude name="**/.#*" />
        <include name="examples/appletClock/" />
        <include name="examples/appletdemo/" />
        <include name="examples/debugdemo/" />
        <include name="examples/hello/" />
        <include name="examples/people/*.java" />
        <include name="examples/people/README.TXT" />
        <include name="examples/people/bluej.pkg" />
        <include name="examples/people/*.ctxt" />
        <include name="examples/people/*.class" />
        <include name="examples/people2/" />
        <include name="examples/picture/" />
        <include name="examples/file-reader/" />
        <include name="examples/shapes/" />
    </patternset>

    <patternset id="bluej.editorclasses" >
        <include name="bluej/editor/" />
        <include name="org/" />
    </patternset>

    <patternset id="bluej.classes" >
        <exclude name="bluej/editor/" />
        <exclude name="org/" />
    </patternset>

    <target name="dist">
        <delete dir="install_tmp" />
        <mkdir dir="install_tmp"/>

        <!-- construct the directory structure we want for the distribution -->
        <copy todir="install_tmp">
            <fileset dir="${bluej_home}" >
                <patternset refid="bluej.libfiles"/>
                <patternset refid="bluej.libdirs"/>
                <patternset refid="bluej.examples"/>
            </fileset>
        </copy>

        <!-- jar up all the editor classes -->
        <jar jarfile="install_tmp/lib/editor.jar" compress="no">
            <fileset dir="${bluej_home}/classes" >
                <patternset refid="bluej.editorclasses"/>
            </fileset>
        </jar>

        <!-- jar up all the other classes -->
        <jar jarfile="install_tmp/lib/bluej.jar" compress="no">
            <fileset dir="${bluej_home}/classes" >
                <patternset refid="bluej.classes"/>
            </fileset>
        </jar>

	<chmod dir="install_tmp" perm="a+r"/>

        <!-- jar the entire distribution into one jar file            -->
        <!-- (use zip instead of jar to avoid generation of manifest) -->
        <zip zipfile="bluej-dist.jar"
             basedir="install_tmp"
             compress="yes"
        />

        <!-- compile and run the installer -->
        <javac srcdir="."
               destdir="."
               includes="Installer.java"
        />

        <!-- NOTE: use  jvm="${java_home}/bin/java"  if java is not in the path -->
        <java classname="Installer" fork="yes" jvm="java">
            <classpath>
                 <pathelement location="." />
            </classpath>
            <arg line="build installer.props"/>
        </java>

        <!-- bundle the resulting class into the final distribution jar file -->
        <jar jarfile="bluej-dist-new.jar"
             basedir="."
             compress="no"
             includes="*.class"
             manifest="manifest"
             whenempty="fail" />

        <!-- cleanup (leaving install_tmp for use by window setup installer) -->
	<delete file="bluej-dist.jar"/>
	<delete>
             <fileset dir="." includes="*.class"/>
        </delete>
    </target>

    <target name="clean">
	<delete file="bluej-dist-new.jar"/>
        <delete dir="install_tmp"/>
    </target>

</project>
